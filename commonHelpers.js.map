{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport axios from 'axios';\n\nlet page; //current page\nlet searchText = ''; //getting from input\nlet totalPages; //total number of pages; using it for more button\nlet gallery = null; //simplelightbox instance\n\nconst refs = {\n  form: document.querySelector('.form'),\n  textInput: document.querySelector('#query'),\n  searchBtn: document.querySelector('.search-button'),\n  galleryList: document.querySelector('.gallery-list'),\n  searchLoader: document.querySelector('.search-loader'),\n  moreLoader: document.querySelector('.more-loader'),\n  moreBtn: document.querySelector('.more-button'),\n  moreWrapper: document.querySelector('.more-wrapper'),\n};\n\n//options for simplelightbox\nconst simplelightboxOptions = {\n  captions: true,\n  captionDelay: 250,\n  captionSelector: 'img',\n  captionType: 'attr',\n  captionsData: 'alt',\n  captionPosition: 'bottom',\n  captionClass: '',\n  captionHTML: true,\n  spinner: true,\n};\n\nrefs.form.addEventListener('submit', onSearch);\n\nasync function onSearch(e) {\n  e.preventDefault();\n\n  //page = 1 by default\n  page = 1;\n\n  //total by default\n  totalPages = 0;\n\n  //show css-loader\n  loaderShow(refs.searchLoader);\n\n  //getting value of input\n  searchText = e.currentTarget.elements.query.value;\n\n  try {\n    //getting images\n    const data = await getImages(searchText);\n\n    //calculating total nunmber of pages\n    totalPages = Math.ceil(data.total / 15);\n\n    //if we're not on last page( there are more pages except current page) , then show more button\n    moreBtnCheck();\n\n    createGallery(data);\n  } catch (err) {\n    console.log(err);\n  }\n  refs.form.reset();\n}\n\n//getting images\nasync function getImages(searchText) {\n  //parameters of searching query\n  const searchParams = new URLSearchParams({\n    key: '42031589-0742425241f8784341d5a922f',\n    q: searchText,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    per_page: 15,\n    page,\n  });\n\n  const response = await axios.get(`https://pixabay.com/api/?${searchParams}`);\n  const data = response.data;\n\n  return data;\n}\n\nfunction templateImage({ largeImageURL, webformatURL, tags }) {\n  return `\n      <li class=\"gallery-item\">\n        <a class=\"gallery-link\" href=\"${largeImageURL}\">\n          <img\n            class=\"gallery-image\"\n            src=\"${webformatURL}\"\n            data-source=\"${largeImageURL}\"\n            alt=\"${tags}\"\n          />\n        </a>\n      </li>\n      `;\n}\n\nfunction templateImages(images) {\n  return images.map(templateImage).join('\\n');\n}\n\nfunction loaderHide(loader) {\n  loader.classList.add('hidden');\n}\n\nfunction loaderShow(loader) {\n  loader.classList.remove('hidden');\n}\n\nfunction moreBtnHide() {\n  refs.moreWrapper.classList.add('hidden');\n}\n\nfunction moreBtnShow() {\n  refs.moreWrapper.classList.remove('hidden');\n}\n\n//deciding to show more button or not\nfunction moreBtnCheck() {\n  if (page < totalPages) {\n    moreBtnShow();\n  } else {\n    moreBtnHide();\n  }\n}\n\nfunction createGallery(data) {\n  //if images are not found, then alert\n  if (data.total === 0) {\n    iziToast.error({\n      message: `Sorry, there are no images matching your search query. Please try again!`,\n      position: 'topRight',\n    });\n\n    //clear gallery if images not found\n    refs.galleryList.innerHTML = '';\n\n    //hiding css-load\n    loaderHide(refs.searchLoader);\n\n    //hiding load more button\n    return;\n  }\n\n  //if images are found, then rendering gallery\n  refs.galleryList.innerHTML = templateImages(data.hits);\n\n  //hiding css-load\n  loaderHide(refs.searchLoader);\n\n  initSimpleLightBox();\n}\n\nfunction initSimpleLightBox() {\n  gallery = new SimpleLightbox('.gallery-list a', simplelightboxOptions);\n  gallery.refresh();\n}\n\nrefs.moreBtn.addEventListener('click', onMoreClick);\n\nasync function onMoreClick(e) {\n  //check if the last page is downloaded, then disable more button and message show\n  if (page + 1 === totalPages) {\n    moreBtnHide();\n    iziToast.info({\n      message: \"We're sorry, but you've reached the end of search results.\",\n      position: 'topRight',\n    });\n  }\n\n  //loader show bottom\n  loaderShow(refs.moreLoader);\n  try {\n    page += 1;\n    gallery.destroy();\n    const data = await getImages(searchText);\n    const markup = templateImages(data.hits);\n\n    moreBtnCheck;\n    loaderHide(refs.moreLoader);\n    refs.galleryList.insertAdjacentHTML('beforeend', markup);\n    smoothScroll();\n    initSimpleLightBox();\n  } catch (err) {\n    loaderHide(refs.moreLoader);\n    console.log(err);\n  }\n}\n\nfunction smoothScroll() {\n  const galleryItem = document.querySelector('.gallery-item');\n\n  // gettinf height of item\n  const galleryItemHeight = galleryItem.getBoundingClientRect().height;\n\n  // scroll fun\n  window.scrollBy({\n    top: galleryItemHeight * 2, // scroll with 2 heights of item\n    behavior: 'smooth', // make scroll smooth\n  });\n}\n"],"names":["page","searchText","totalPages","gallery","refs","simplelightboxOptions","onSearch","loaderShow","data","getImages","moreBtnCheck","createGallery","err","searchParams","axios","templateImage","largeImageURL","webformatURL","tags","templateImages","images","loaderHide","loader","moreBtnHide","moreBtnShow","iziToast","initSimpleLightBox","SimpleLightbox","onMoreClick","markup","smoothScroll","galleryItemHeight"],"mappings":"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"}